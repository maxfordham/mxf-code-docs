
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>5. Deploying &#8212; mfcode developer docs</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="6. databases" href="databases.html" />
    <link rel="prev" title="4. Packaging" href="packaging.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      <img src="../_static/mfcode.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">mfcode developer docs</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="index.html">
   mfcode_docs
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   1. Intro
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="developing.html">
   2. Developing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="developing-envsetup.html">
   3. Standalone Development
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="packaging.html">
   4. Packaging
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   5. Deploying
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="databases.html">
   6. databases
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="objectModels.html">
   7. Object Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="objectModels-projectschema.html">
   8. Project
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="jb-rendering-demo.html">
   9. Jupyter Book rendering demo
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/docs/deploying.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#juptyerhub-server">
   5.1. JuptyerHub Server
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#accessing-the-server">
     5.1.1. Accessing the Server
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#check-server-performance">
     5.1.2. Check server performance
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#update-if-required">
     5.1.3. Update if required
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#building-repo2docker-apps-that-use-internal-private-conda-repository-s">
   5.2. Building repo2docker apps that use internal (private) conda repository’s
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sss-putty-onto-the-stbarts-server">
     5.2.1. SSS/ Putty onto the StBarts server
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mount-the-conda-build-folder-on-the-server">
     5.2.2. mount the conda-build folder on the server
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#start-the-conda-channel-server">
     5.2.3. Start the conda-channel server
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#build-the-repo2docker-image">
     5.2.4. Build the repo2docker image
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="deploying">
<h1><span class="section-number">5. </span>Deploying<a class="headerlink" href="#deploying" title="Permalink to this headline">¶</a></h1>
<div class="section" id="juptyerhub-server">
<h2><span class="section-number">5.1. </span>JuptyerHub Server<a class="headerlink" href="#juptyerhub-server" title="Permalink to this headline">¶</a></h2>
<p>The general development environment is a JupyterHub server (Linux Ubuntu 20.04) that is accessible to everyone and independent of any other software. Conda / Mamba is used for package management (see later) meaning there is robust version control and record of previous versions.</p>
<p>Refer to:
<a class="reference external" href="https://github.com/gunstonej/jupyterhub-maxfordham">jupyterhub-maxfordham</a>
for the repo developed by QuantStack that automates processes on the JupyterHub server using ansible playbooks</p>
<div class="section" id="accessing-the-server">
<h3><span class="section-number">5.1.1. </span>Accessing the Server<a class="headerlink" href="#accessing-the-server" title="Permalink to this headline">¶</a></h3>
<p>install putty.</p>
<p>you need the following credententials to SSH / Putty onto the StBarts server:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>host name</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>port</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>username</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>password</p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
<p>these can be found in your secret _secret_config.toml file.</p>
</div>
<div class="section" id="check-server-performance">
<h3><span class="section-number">5.1.2. </span>Check server performance<a class="headerlink" href="#check-server-performance" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>htop <span class="c1">#  for system monitoring information / server load</span>
</pre></div>
</div>
</div>
<div class="section" id="update-if-required">
<h3><span class="section-number">5.1.3. </span>Update if required<a class="headerlink" href="#update-if-required" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://askubuntu.com/questions/196768/how-to-install-updates-via-command-line">ref</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo apt update        <span class="c1"># Fetches the list of available updates</span>
sudo apt upgrade       <span class="c1"># Installs some updates; does not remove packages</span>
sudo apt full-upgrade  <span class="c1"># Installs updates; may also remove some packages, if needed</span>
sudo apt autoremove    <span class="c1"># Removes any old packages that are no longer needed</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="building-repo2docker-apps-that-use-internal-private-conda-repository-s">
<h2><span class="section-number">5.2. </span>Building repo2docker apps that use internal (private) conda repository’s<a class="headerlink" href="#building-repo2docker-apps-that-use-internal-private-conda-repository-s" title="Permalink to this headline">¶</a></h2>
<p>The jupyterhub is configured to use the repo2docker tool:
<a class="reference external" href="https://github.com/gunstonej/jupyterhub-maxfordham/blob/master/docs/environments.md">https://github.com/gunstonej/jupyterhub-maxfordham/blob/master/docs/environments.md</a></p>
<p>This creates a docker image with the required environment for the contents of the repo to run.
Generally, it downloads packages from conda-forge, but for internally developed private conda
packages we need to expose the packages to the server and repo2docker tool as it is building.</p>
<p>It’s not possible to mount barbados onto stbarts and reference the channel in the conventional sense because it doesn’t get exposed in the docker instances created when running repo2docker.
Instead the process is to start a local web server which the docker instances can access.</p>
<p><strong>To do this:</strong></p>
<div class="section" id="sss-putty-onto-the-stbarts-server">
<h3><span class="section-number">5.2.1. </span>SSS/ Putty onto the StBarts server<a class="headerlink" href="#sss-putty-onto-the-stbarts-server" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="mount-the-conda-build-folder-on-the-server">
<h3><span class="section-number">5.2.2. </span>mount the conda-build folder on the server<a class="headerlink" href="#mount-the-conda-build-folder-on-the-server" title="Permalink to this headline">¶</a></h3>
<p>this only needs to be done after the server has been switched off, otherwise the mount will persist.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir /mnt/conda-bld
sudo mount -t cifs -o <span class="nv">user</span><span class="o">={{</span> mf.user <span class="o">}}</span>,password<span class="o">={{</span> mf.password <span class="o">}}</span> servers.mffileserver.FDIR_CONDA_BUILD /mnt/conda-bld
</pre></div>
</div>
</div>
<div class="section" id="start-the-conda-channel-server">
<h3><span class="section-number">5.2.3. </span>Start the conda-channel server<a class="headerlink" href="#start-the-conda-channel-server" title="Permalink to this headline">¶</a></h3>
<p>Start the webserver on the conda channel - it’s important that you do this on St Barts. Doing it from your local machine isn’t sufficient.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /mnt/conda-bld
python3 -m http.server
</pre></div>
</div>
<p>Check that the conda file-server is exposed by visiting:
‘’’’’’ and you should see the MF Conda Channel Index page.</p>
</div>
<div class="section" id="build-the-repo2docker-image">
<h3><span class="section-number">5.2.4. </span>Build the repo2docker image<a class="headerlink" href="#build-the-repo2docker-image" title="Permalink to this headline">¶</a></h3>
<p>Then in your repo2docker repsitory binder/environment.yml add the reference to the MF Channel like so.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>channels:
  - defaults
  - conda-forge
  - <span class="o">{{</span> servers.mffileserver.IP_TEMP_CONDA_FILESERVER <span class="o">}}</span>
dependencies:
  - my_really_cool_mf_conda_package
</pre></div>
</div>
<p><strong>note</strong>. currently
​
Then build the image in the conventional way. Once this has complete you can then kill the local server running in conda-bld since it is only used during the installation process.</p>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./docs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="packaging.html" title="previous page"><span class="section-number">4. </span>Packaging</a>
    <a class='right-next' id="next-link" href="databases.html" title="next page"><span class="section-number">6. </span>databases</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By John Gunstone<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>